#!/usr/bin/env python2
# -*- coding: utf-8 -*-
"""
Created on 2017.08.07 14:52:29

@author: Karim Pedia
"""

# ======================================================================================================================
# ----------------------------------------------------------------------------------------------------- Priority Imports
from __future__ import print_function
# -------------------------------------------------------------------------------------------------- Python Lib. Imports
import os
# ----------------------------------------------------------------------------------------------- 3rd Party Lib. Imports
# ---------------------------------------------------------------------------------------------------- Developer Imports
# ------------------------------------------------------------------------------------------------- This package Imports
# ---------------------------------------------------------------------------------------------- This experiment Imports
# ----------------------------------------------------------------------------------------------------------------------
# ======================================================================================================================


# ======================================================================================================================
# ----------------------------------------------------------------------------------------------------------------------
GPU_MEM_FRAC_NAME = 'GPU_MEM_FRAC'
OMP_NUM_THREADS_NAME = 'OMP_NUM_THREADS'
# ----------------------------------------------------------------------------------------------------------------------
# ======================================================================================================================


# ======================================================================================================================
# ----------------------------------------------------------------------------------------------------------------------
def get_tf_session(default_mem_frac=0.333):
    import tensorflow as tf
    gpu_mem_frac = os.environ.get(GPU_MEM_FRAC_NAME)
    gpu_mem_frac = default_mem_frac if gpu_mem_frac is None else float(gpu_mem_frac)
    num_threads = os.environ.get(OMP_NUM_THREADS_NAME)
    gpu_options = tf.GPUOptions(allow_growth=True, per_process_gpu_memory_fraction=gpu_mem_frac)
    config = tf.ConfigProto(gpu_options=gpu_options, intra_op_parallelism_threads=num_threads) \
        if num_threads else tf.ConfigProto(gpu_options=gpu_options)
    return tf.Session(config=config)
# ----------------------------------------------------------------------------------------------------------------------
# ======================================================================================================================
